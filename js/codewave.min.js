(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=function(a,b){function c(){this.constructor=a}for(var d in b)y.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},y={}.hasOwnProperty,z=[].slice,A=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};this.Codewave=function(){function a(b,c){var d,e,f;this.editor=b,null==c&&(c={}),this.marker="[[[[codewave_marquer]]]]",this.vars={},d={brakets:"~~",deco:"~",closeChar:"/",noExecuteChar:"!",carretChar:"|",checkCarret:!0,inInstance:null},this.parent=c.parent;for(e in d)f=d[e],e in c?this[e]=c[e]:null!=this.parent&&"parent"!==e?this[e]=this.parent[e]:this[e]=f;null!=this.editor&&this.editor.bindedTo(this),this.context=new a.Context(this),null!=this.inInstance&&(this.context.parent=this.inInstance.context)}return a.prototype.onActivationKey=function(){return this.process=new a.Process,a.logger.log("activation key"),this.runAtCursorPos(),this.process=null},a.prototype.runAtCursorPos=function(){return this.editor.allowMultiSelection()?this.runAtMultiPos(this.editor.getMultiSel()):this.runAtPos(this.editor.getCursorPos())},a.prototype.runAtPos=function(a){return this.runAtMultiPos([a])},a.prototype.runAtMultiPos=function(b){var c;return b.length>0?(c=this.commandOnPos(b[0].end),null!=c?(b.length>1&&c.setMultiPos(b),c.init(),a.logger.log(c),c.execute()):b[0].start===b[0].end?this.addBrakets(b):this.promptClosingCmd(b)):void 0},a.prototype.commandOnPos=function(b){var c,d;if(this.precededByBrakets(b)&&this.followedByBrakets(b)&&this.countPrevBraket(b)%2===1)d=b-this.brakets.length,c=b;else{if(this.precededByBrakets(b)&&this.countPrevBraket(b)%2===0&&(b-=this.brakets.length),d=this.findPrevBraket(b),null==d)return null;if(c=this.findNextBraket(b-1),null===c||this.countPrevBraket(d)%2!==0)return null}return new a.PositionedCmdInstance(this,d,this.editor.textSubstr(d,c+this.brakets.length))},a.prototype.nextCmd=function(b){var c,d,e;for(null==b&&(b=0),e=b;d=this.findAnyNext(e,[this.brakets,"\n"]);)if(e=d.pos+d.str.length,d.str===this.brakets){if("undefined"!=typeof c&&null!==c)return new a.PositionedCmdInstance(this,c,this.editor.textSubstr(c,d.pos+this.brakets.length));c=d.pos}else c=null;return null},a.prototype.getEnclosingCmd=function(a){var b,c,d,e;for(null==a&&(a=0),d=a,b=this.brakets+this.closeChar;null!=(e=this.findNext(d,b));)if(c=this.commandOnPos(e+b.length)){if(d=c.getEndPos(),c.pos<a)return c}else d=e+b.length;return null},a.prototype.precededByBrakets=function(a){return this.editor.textSubstr(a-this.brakets.length,a)===this.brakets},a.prototype.followedByBrakets=function(a){return this.editor.textSubstr(a,a+this.brakets.length)===this.brakets},a.prototype.countPrevBraket=function(a){var b;for(b=0;a=this.findPrevBraket(a);)b++;return b},a.prototype.isEndLine=function(a){return"\n"===this.editor.textSubstr(a,a+1)||a+1>=this.editor.textLen()},a.prototype.findLineStart=function(a){var b;return b=this.findAnyNext(a,["\n"],-1),b?b.pos+1:0},a.prototype.findLineEnd=function(a){var b;return b=this.findAnyNext(a,["\n","\r"]),b?b.pos:this.editor.textLen()},a.prototype.findPrevBraket=function(a){return this.findNextBraket(a,-1)},a.prototype.findNextBraket=function(a,b){var c;return null==b&&(b=1),c=this.findAnyNext(a,[this.brakets,"\n"],b),c&&c.str===this.brakets?c.pos:void 0},a.prototype.findPrev=function(a,b){return this.findNext(a,b,-1)},a.prototype.findNext=function(a,b,c){var d;return null==c&&(c=1),d=this.findAnyNext(a,[b],c),d?d.pos:void 0},a.prototype.findAnyNext=function(b,c,d){var e,f,g,h,i,j,k;for(null==d&&(d=1),k=d>0?this.editor.textSubstr(b,this.editor.textLen()):this.editor.textSubstr(0,b),e=null,i=0,g=c.length;g>i;i++)j=c[i],h=d>0?k.indexOf(j):k.lastIndexOf(j),-1!==h&&(null==e||e*d>h*d)&&(e=h,f=j);return null!=f?new a.util.StrPos(d>0?e+b:e,f):null},a.prototype.findMatchingPair=function(a,b,c,d){var e,f,g;for(null==d&&(d=1),g=a,f=0;e=this.findAnyNext(g,[c,b],d);)if(g=e.pos+(d>0?e.str.length:0),e.str===(d>0?c:b)){if(!(f>0))return e;f--}else f++;return null},a.prototype.addBrakets=function(b){var c;return b=a.util.posCollection(b),c=b.wrap(this.brakets,this.brakets).map(function(a){return a.selectContent()}),this.editor.applyReplacements(c)},a.prototype.promptClosingCmd=function(b){return null!=this.closingPromp&&this.closingPromp.stop(),this.closingPromp=a.ClosingPromp.newFor(this,b).begin()},a.prototype.parseAll=function(b){var c,d,e;for(null==b&&(b=!0),e=0;c=this.nextCmd(e);)e=c.getEndPos(),this.editor.setCursorPos(e),c.init(),!b||null==c.content||null!=c.getCmd()&&c.getOption("preventParseAll")||(d=new a(new a.TextParser(c.content),{parent:this}),c.content=d.parseAll()),null!=c.execute()&&(e=null!=c.replaceEnd?c.replaceEnd:this.editor.getCursorPos().end);return this.getText()},a.prototype.getText=function(){return this.editor.text()},a.prototype.isRoot=function(){return null==this.parent&&(null==this.inInstance||null==this.inInstance.finder)},a.prototype.getRoot=function(){return this.isRoot?this:null!=this.parent?this.parent.getRoot():null!=this.inInstance?this.inInstance.codewave.getRoot():void 0},a.prototype.removeCarret=function(a){return CodeWave.util.removeCarret(a,this.carretChar)},a.prototype.getCarretPos=function(a){return CodeWave.util.getCarretPos(a,this.carretChar)},a.prototype.regMarker=function(b){return null==b&&(b="g"),new RegExp(a.util.escapeRegExp(this.marker),b)},a.prototype.removeMarkers=function(a){return a.replace(this.regMarker(),"")},a}(),this.Codewave.init=function(){return Codewave.Command.initCmds(),Codewave.Command.loadCmds()},j=function(){function a(a,b){this.pos=a,this.str=b}return a.prototype.end=function(){return this.pos+this.str.length},a}(),g=function(){function a(a,b){this.start=a,this.end=b}return a.prototype.containsPt=function(a){return this.start<=a&&a<=this.end},a.prototype.containsPos=function(a){return this.start<=a.start&&a.end<=this.end},a.prototype.wrappedBy=function(a,b){return new k(this.start-a.length,this.start,this.end,this.end+b.length)},a.prototype.textFromEditor=function(a){return a.textSubstr(this.start,this.end)},a.prototype.applyOffset=function(a){return 0!==a&&(this.start+=a,this.end+=a),this},a.prototype.copy=function(){return new a(this.start,this.end)},a}(),k=function(a){function b(a,b,c,d){this.start=a,this.innerStart=b,this.innerEnd=c,this.end=d}return x(b,a),b.prototype.innerContainsPt=function(a){return this.innerStart<=a&&a<=this.innerEnd},b.prototype.innerContainsPos=function(a){return this.innerStart<=a.start&&a.end<=this.innerEnd},b.prototype.innerTextFromEditor=function(a){return a.textSubstr(this.innerStart,this.innerEnd)},b.prototype.setInnerLen=function(a){return this.moveSufix(this.innerStart+a)},b.prototype.moveSuffix=function(a){var b;return b=this.end-this.innerEnd,this.innerEnd=a,this.end=this.innerEnd+b},b.prototype.copy=function(){return new b(this.start,this.innerStart,this.innerEnd,this.end)},b}(g),i=function(){function a(a,b){this.width=a,this.height=b}return a}(),h=function(){function a(a,b,c,d,e){this.start=a,this.end=b,this.text=c,this.prefix=null!=d?d:"",this.suffix=null!=e?e:"",this.selections=[]}return a.prototype.resPosBeforePrefix=function(){return this.start+this.prefix.length+this.text.length},a.prototype.resEnd=function(a){return null==a&&(a=null),this.start+this.finalText(a).length},a.prototype.applyToEditor=function(a){return a.spliceText(this.start,this.end,this.finalText(a))},a.prototype.necessaryFor=function(a){return this.finalText(a)!==a.textSubstr(this.start,this.end)},a.prototype.originalTextWith=function(a){return a.textSubstr(this.start,this.end)},a.prototype.finalText=function(a){return null==a&&(a=null),this.prefix+this.text+this.suffix},a.prototype.offsetAfter=function(){return this.finalText().length-(this.end-this.start)},a.prototype.applyOffset=function(a){var b,c,d,e;if(0!==a)for(this.start+=a,this.end+=a,d=this.selections,c=0,b=d.length;b>c;c++)e=d[c],e.start+=a,e.end+=a;return this},a.prototype.selectContent=function(){return this.selections=[new g(this.prefix.length+this.start,this.prefix.length+this.start+this.text.length)],this},a.prototype.carretToSel=function(){var a,b,c,d;for(this.selections=[],d=this.finalText(),this.prefix=Codewave.util.removeCarret(this.prefix),this.text=Codewave.util.removeCarret(this.text),this.suffix=Codewave.util.removeCarret(this.suffix),c=this.start;null!=(b=Codewave.util.getAndRemoveFirstCarret(d));)a=b[0],d=b[1],this.selections.push(new g(c+a,c+a));return this},a.prototype.copy=function(){var b;return b=new a(this.start,this.end,this.text,this.prefix,this.suffix),b.selections=this.selections.map(function(a){return a.copy()}),b},a}(),l=function(a){function b(a,b,c,d){this.start=a,this.end=b,this.prefix=null!=c?c:"",this.suffix=null!=d?d:"",this.text="",this.selections=[]}return x(b,a),b.prototype.applyToEditor=function(a){return this.adjustSelFor(a),b.__super__.applyToEditor.call(this,a)},b.prototype.adjustSelFor=function(a){var b,c,d,e,f,g;for(c=this.originalTextWith(a).length,e=this.selections,f=[],d=0,b=e.length;b>d;d++)g=e[d],g.start>this.start+this.prefix.length&&(g.start+=c),f.push(g.end>=this.start+this.prefix.length?g.end+=c:void 0);return f},b.prototype.finalText=function(a){var b;return null==a&&(a=null),b=null!=a?this.originalTextWith(a):"",this.prefix+b+this.suffix},b.prototype.offsetAfter=function(){return this.prefix.length+this.suffix.length},b.prototype.copy=function(){var a;return a=new b(this.start,this.end,this.prefix,this.suffix),a.selections=this.selections.map(function(a){return a.copy()}),a},b}(h),f=function(){function a(a,b,c){this.opener=a,this.closer=b,this.options=null!=c?c:{}}return a.prototype.openerReg=function(){return"string"==typeof this.opener?new RegExp(Codewave.util.escapeRegExp(this.opener)):this.opener},a.prototype.closerReg=function(){return"string"==typeof this.closer?new RegExp(Codewave.util.escapeRegExp(this.closer)):this.closer},a.prototype.matchAnyParts=function(){return{opener:this.openerReg(),closer:this.closerReg()}},a.prototype.matchAnyPartKeys=function(){var a,b,c,d;b=[],c=this.matchAnyParts();for(a in c)d=c[a],b.push(a);return b},a.prototype.matchAnyReg=function(){var a,b,c,d;a=[],c=this.matchAnyParts();for(b in c)d=c[b],a.push("("+d.source+")");return new RegExp(a.join("|"))},a.prototype.matchAny=function(a){return this.matchAnyReg().exec(a)},a.prototype.matchAnyNamed=function(a){return this._matchAnyGetName(this.matchAny(a))},a.prototype._matchAnyGetName=function(a){var b,c,d,e;if(a){for(c=e=0,d=a.length;d>e;c=++e)if(b=a[c],c>0&&null!=b)return this.matchAnyPartKeys()[c-1];return null}},a.prototype.matchAnyLast=function(a){var b,c,d;for(b=a;c=this.matchAny(b);)b=b.substr(c.index+1),d=c;return d},a.prototype.matchAnyLastNamed=function(a){return this._matchAnyGetName(this.matchAnyLast(a))},a.prototype.isWapperOf=function(a,b){return"closer"===this.matchAnyNamed(b.substr(a.end))&&"opener"===this.matchAnyLastNamed(b.substr(0,a.start))},a}(),this.Codewave.util={splitFirstNamespace:function(a,b){var c;return null==b&&(b=!1),-1!==a.indexOf(":")||b?(c=a.split(":"),[c.shift(),c.join(":")||null]):[null,a]},splitNamespace:function(a){var b,c;return-1===a.indexOf(":")?[null,a]:(c=a.split(":"),b=c.pop(),[c.join(":"),b])},trimEmptyLine:function(a){return a.replace(/^\s*\r?\n/,"").replace(/\r?\n\s*$/,"")},escapeRegExp:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},repeatToLength:function(a,b){return 0>=b?"":Array(Math.ceil(b/a.length)+1).join(a).substring(0,b)},getTxtSize:function(a){var b,c,d,e,f;for(d=a.replace(/\r/g,"").split("\n"),f=0,e=0,c=d.length;c>e;e++)b=d[e],f=Math.max(f,b.length);return new i(f,d.length-1)},reverseStr:function(a){return a.split("").reverse().join("")},removeCarret:function(a,b){var c,d,e,f;return null==b&&(b="|"),f="[[[[quoted_carret]]]]",c=new RegExp(Codewave.util.escapeRegExp(b),"g"),d=new RegExp(Codewave.util.escapeRegExp(b+b),"g"),e=new RegExp(Codewave.util.escapeRegExp(f),"g"),a.replace(d,f).replace(c,"").replace(e,b)},getAndRemoveFirstCarret:function(a,b){var c;return null==b&&(b="|"),c=Codewave.util.getCarretPos(a,b),null!=c?(a=a.substr(0,c)+a.substr(c+b.length),[c,a]):void 0},getCarretPos:function(a,b){var c,d;return null==b&&(b="|"),d=new RegExp(Codewave.util.escapeRegExp(b+b),"g"),a=a.replace(d," "),(c=a.indexOf(b))>-1?c:void 0},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},posCollection:function(a){return!Codewave.util.isArray(a),a.wrap=function(a,b){return this.map(function(c){return new l(c.start,c.end,a,b)})},a.replace=function(a){return this.map(function(b){return new h(b.start,b.end,a)})},a},StrPos:j,Pos:g,WrappedPos:k,Size:i,Pair:f,Replacement:h,union:function(a,b){return Codewave.util.unique(a.concat(b))},unique:function(a){var b,c,d;for(b=a.concat(),c=0;c<b.length;){for(d=c+1;d<b.length;)b[c]===b[d]&&b.splice(d--,1),++d;++c}return b},merge:function(){var a;return a=1<=arguments.length?z.call(arguments,0):[],(null!=a?a.length:void 0)>0?Codewave.util.tap({},function(b){var c,d,e,f,g,h;for(f=[],e=0,d=a.length;d>e;e++)h=a[e],f.push(function(){var a;a=[];for(c in h)g=h[c],a.push(b[c]=g);return a}());return f}):void 0},tap:function(a,b){return b(a),a}},this.Codewave.storage=new(function(){function a(){}return a.prototype.save=function(a,b){return localStorage.setItem(this.fullKey(a),JSON.stringify(b))},a.prototype.load=function(a){return JSON.parse(localStorage.getItem(this.fullKey(a)))},a.prototype.fullKey=function(a){return"CodeWave_"+a},a}()),this.Codewave.Editor=function(){function a(){this.namespace=null}return a.prototype.bindedTo=function(a){},a.prototype.text=function(a){throw"Not Implemented"},a.prototype.textCharAt=function(a){throw"Not Implemented"},a.prototype.textLen=function(){throw"Not Implemented"},a.prototype.textSubstr=function(a,b){throw"Not Implemented"},a.prototype.insertTextAt=function(a,b){throw"Not Implemented"},a.prototype.spliceText=function(a,b,c){throw"Not Implemented"},a.prototype.getCursorPos=function(){throw"Not Implemented"},a.prototype.setCursorPos=function(a,b){throw null==b&&(b=null),"Not Implemented"},a.prototype.beginUndoAction=function(){},a.prototype.endUndoAction=function(){},a.prototype.getLang=function(){return null},a.prototype.getEmmetContextObject=function(){return null},a.prototype.allowMultiSelection=function(){return!1},a.prototype.setMultiSel=function(a){throw"Not Implemented"},a.prototype.getMultiSel=function(){throw"Not Implemented"},a.prototype.canListenToChange=function(){return!1},a.prototype.addChangeListener=function(a){throw"Not Implemented"},a.prototype.removeChangeListener=function(a){throw"Not Implemented"},a.prototype.applyReplacements=function(a){var b,c,d,e,f;for(f=[],c=0,d=0,b=a.length;b>d;d++)e=a[d],e.applyOffset(c),e.applyToEditor(this),c+=e.offsetAfter(this),f=f.concat(e.selections);return this.applyReplacementsSelections(f)},a.prototype.applyReplacementsSelections=function(a){return a.length>0?(console.log(a),this.allowMultiSelection()?this.setMultiSel(a):this.setCursorPos(a[0].start,a[0].end)):void 0},a}(),this.Codewave.TextParser=function(a){function b(a){this._text=a,self.namespace="text_parser"}return x(b,a),b.prototype.text=function(a){return null!=a&&(this._text=a),this._text},b.prototype.textCharAt=function(a){return this.text()[a]},b.prototype.textLen=function(a){return this.text().length},b.prototype.textSubstr=function(a,b){return this.text().substring(a,b)},b.prototype.insertTextAt=function(a,b){return this.text(this.text().substring(0,b)+a+this.text().substring(b,this.text().length))},b.prototype.spliceText=function(a,b,c){return this.text(this.text().slice(0,a)+(c||"")+this.text().slice(b))},b.prototype.getCursorPos=function(){return this.target},b.prototype.setCursorPos=function(a,b){return arguments.length<2&&(b=a),this.target={start:a,end:b}},b}(this.Codewave.Editor),this.Codewave.EditCmdProp=function(){function a(a,b){var c,d,e,f,g,h;for(this.name=a,c={"var":null,opt:null,funct:null,dataName:null,showEmpty:!1,carret:!1},g=["var","opt","funct"],f=0,e=g.length;e>f;f++)d=g[f],d in b&&(c.dataName=b[d]);for(d in c)h=c[d],d in b?this[d]=b[d]:this[d]=h}return a.prototype.setCmd=function(a){return a[this.name]=Codewave.Command.setVarCmd(this.name)},a.prototype.writeFor=function(a,b){return null!=a.vars[this.name]?b[this.dataName]=a.vars[this.name]:void 0},a.prototype.valFromCmd=function(a){if(null!=a){if(null!=this.opt)return a.getOption(this.opt);if(null!=this.funct)return a[this.funct]();if(null!=this["var"])return a[this["var"]]}},a.prototype.showForCmd=function(a){var b;return b=this.valFromCmd(a),this.showEmpty||null!=b},a.prototype.display=function(a){return this.showForCmd(a)?"~~"+this.name+"~~\n"+(this.valFromCmd(a)||"")+(this.carret?"|":"")+"\n~~/"+this.name+"~~":void 0},a}(),this.Codewave.EditCmdProp.source=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.valFromCmd=function(a){var c;return c=b.__super__.valFromCmd.call(this,a),null!=c&&(c=c.replace(/\|/g,"||")),c},b}(this.Codewave.EditCmdProp),this.Codewave.EditCmdProp.string=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.display=function(a){return null!=this.valFromCmd(a)?"~~!"+this.name+" '"+this.valFromCmd(a)+(this.carret?"|":"")+"'~~":void 0},b}(this.Codewave.EditCmdProp),this.Codewave.EditCmdProp.revBool=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.setCmd=function(a){return a[this.name]=Codewave.Command.setBoolVarCmd(this.name)},b.prototype.writeFor=function(a,b){return null!=a.vars[this.name]?b[this.dataName]=!a.vars[this.name]:void 0},b.prototype.display=function(a){var b;return b=this.valFromCmd(a),null==b||b?void 0:"~~!"+this.name+"~~"},b}(this.Codewave.EditCmdProp),this.Codewave.EditCmdProp.bool=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.setCmd=function(a){return a[this.name]=Codewave.Command.setBoolVarCmd(this.name)},b.prototype.display=function(a){return this.valFromCmd(a)?"~~!"+this.name+"~~":void 0},b}(this.Codewave.EditCmdProp),this.Codewave.DomKeyListener=function(){function a(){}return a.prototype.startListening=function(a){var b,c,d,e;return e=null,b=function(a){return function(b){return 69===b.keyCode&&b.ctrlKey&&(b.preventDefault(),null!=a.onActivationKey)?a.onActivationKey():void 0}}(this),d=function(a){return function(b){return null!=a.onAnyChange?a.onAnyChange(b):void 0}}(this),c=function(a){return function(b){return null!=e&&clearTimeout(e),e=setTimeout(function(){return null!=a.onAnyChange?a.onAnyChange(b):void 0},100)}}(this),a.addEventListener?(a.addEventListener("keydown",b),a.addEventListener("keyup",d),a.addEventListener("keypress",c)):a.attachEvent?(a.attachEvent("onkeydown",b),a.attachEvent("onkeyup",d),a.attachEvent("onkeypress",c)):void 0},a}(),this.Codewave.TextAreaEditor=function(a){function b(a){this.target=a,this.obj=document.getElementById(this.target),this.namespace="textarea",this.changeListeners=[]}return x(b,a),b.prototype.startListening=Codewave.DomKeyListener.prototype.startListening,b.prototype.onAnyChange=function(a){var b,c,d,e,f;for(console.log("onAnyChange"),e=this.changeListeners,f=[],d=0,c=e.length;c>d;d++)b=e[d],f.push(b());return f},b.prototype.bindedTo=function(a){return this.onActivationKey=function(){return a.onActivationKey()},this.startListening(document)},b.prototype.selectionPropExists=function(){return"selectionStart"in this.obj},b.prototype.hasFocus=function(){return document.activeElement===this.obj},b.prototype.text=function(a){return null!=a&&(this.textEventChange(a)||(this.obj.value=a)),this.obj.value},b.prototype.spliceText=function(a,c,d){return this.textEventChange(d,a,c)||b.__super__.spliceText.call(this,a,c,d)},b.prototype.textEventChange=function(a,b,c){var d;return null==b&&(b=0),null==c&&(c=null),null!=document.createEvent&&(d=document.createEvent("TextEvent")),null!=d&&null!=d.initTextEvent?(null==c&&(c=this.textLen()),d.initTextEvent("textInput",!0,!0,null,a||"\x00",9),this.obj.selectionStart=b,this.obj.selectionEnd=c,this.obj.dispatchEvent(d),!0):!1},b.prototype.getCursorPos=function(){return null!=this.tmpCursorPos?this.tmpCursorPos:this.hasFocus?this.selectionPropExists?new Codewave.util.Pos(this.obj.selectionStart,this.obj.selectionEnd):this.getCursorPosFallback():void 0},b.prototype.getCursorPosFallback=function(){var a,b,c,d;if(this.obj.createTextRange&&(d=document.selection.createRange(),d.parentElement()===this.obj)){for(c=this.obj.createTextRange(),c.moveToBookmark(d.getBookmark()),a=0;c.compareEndPoints("EndToStart",c)>0;)a++,c.moveEnd("character",-1);for(c.setEndPoint("StartToStart",this.obj.createTextRange()),b=new Codewave.util.Pos(0,a);c.compareEndPoints("EndToStart",c)>0;)b.start++,b.end++,c.moveEnd("character",-1);return b}},b.prototype.setCursorPos=function(a,b){console.log([a,b]),arguments.length<2&&(b=a),this.selectionPropExists?(this.tmpCursorPos={start:a,end:b},this.obj.selectionStart=a,this.obj.selectionEnd=b,setTimeout(function(c){return function(){return c.tmpCursorPos=null,c.obj.selectionStart=a,c.obj.selectionEnd=b}}(this),1)):this.setCursorPosFallback(a,b)},b.prototype.setCursorPosFallback=function(a,b){var c;return this.obj.createTextRange?(c=this.obj.createTextRange(),c.moveStart("character",a),c.collapse(),c.moveEnd("character",b-a),c.select()):void 0},b.prototype.getLang=function(){return this.obj.hasAttribute("data-lang")?this.obj.getAttribute("data-lang"):void 0},b.prototype.canListenToChange=function(){return!0},b.prototype.addChangeListener=function(a){return this.changeListeners.push(a)},b.prototype.removeChangeListener=function(a){var b;return(b=this.changeListeners.indexOf(a))>-1?this.changeListeners.splice(b,1):void 0},b.prototype.applyReplacements=function(a){return a.length>0&&a[0].selections.length<1&&(a[0].selections=[this.getCursorPos()]),b.__super__.applyReplacements.call(this,a)},b}(Codewave.TextParser),this.Codewave.util.BoxHelper=function(){function a(a,b){var c,d,e;this.context=a,null==b&&(b={}),c={deco:this.context.codewave.deco,pad:2,width:50,height:3,openText:"",closeText:"",indent:0};for(d in c)e=c[d],d in b?this[d]=b[d]:this[d]=e}return a.prototype.draw=function(a){return this.startSep()+"\n"+this.lines(a)+"\n"+this.endSep()},a.prototype.wrapComment=function(a){return this.context.wrapComment(a)},a.prototype.separator=function(){var a;return a=this.width+2*this.pad+2*this.deco.length,this.wrapComment(this.decoLine(a))},a.prototype.startSep=function(){var a;return a=this.width+2*this.pad+2*this.deco.length-this.openText.length,this.wrapComment(this.openText+this.decoLine(a))},a.prototype.endSep=function(){var a;return a=this.width+2*this.pad+2*this.deco.length-this.closeText.length,this.wrapComment(this.closeText+this.decoLine(a))},a.prototype.decoLine=function(a){return Codewave.util.repeatToLength(this.deco,a)},a.prototype.padding=function(){return Codewave.util.repeatToLength(" ",this.pad)},a.prototype.lines=function(a,b){var c,d,e;return null==a&&(a=""),null==b&&(b=!0),a=a||"",d=a.replace(/\r/g,"").split("\n"),b?function(){var a,b,c;for(c=[],e=a=0,b=this.height;b>=0?b>=a:a>=b;e=b>=0?++a:--a)c.push(this.line(d[e]||""));return c}.call(this).join("\n"):function(){var a,b,e;for(e=[],b=0,a=d.length;a>b;b++)c=d[b],e.push(this.line(c));return e}.call(this).join("\n")},a.prototype.line=function(a){return null==a&&(a=""),Codewave.util.repeatToLength(" ",this.indent)+this.wrapComment(this.deco+this.padding()+a+Codewave.util.repeatToLength(" ",this.width-this.removeIgnoredContent(a).length)+this.padding()+this.deco)},a.prototype.removeIgnoredContent=function(a){return this.context.codewave.removeMarkers(this.context.codewave.removeCarret(a))},a.prototype.textBounds=function(a){return Codewave.util.getTxtSize(this.removeIgnoredContent(a))},a.prototype.getBoxForPos=function(a){var b,c,d,e;return e=this.context.wrapCommentLeft(this.deco+this.deco),c=this.context.wrapCommentRight(this.deco+this.deco),d=this.context.codewave.findPrev(a.start,e),b=this.context.codewave.findNext(a.end,c),null!=d&&null!=b?new Codewave.util.Pos(d,b+c.length):void 0},a.prototype.getOptFromLine=function(a,b){var c,d,e,f,g,h;return null==b&&(b=!0),e=new RegExp("(\\s*)("+Codewave.util.escapeRegExp(this.context.wrapCommentLeft(this.deco))+")(\\s*)"),d=new RegExp("(\\s*)("+Codewave.util.escapeRegExp(this.context.wrapCommentRight(this.deco))+")"),g=e.exec(a),f=d.exec(a),null!=g&&null!=f&&(b&&(this.pad=Math.min(g[3].length,f[1].length)),this.indent=g[1].length,h=g.index+g[1].length+g[2].length+this.pad,c=f.index+f[1].length-this.pad,this.width=c-h),this},a.prototype.reformatLines=function(a,b){return null==b&&(b={}),this.lines(this.removeComment(a,b),!1)},a.prototype.removeComment=function(a,b){var c,d,e,f,g,h,i,j;return null==b&&(b={}),null!=a?(c={multiline:!0},h=Codewave.util.merge(c,b),d=Codewave.util.escapeRegExp(this.context.wrapCommentLeft()),e=Codewave.util.escapeRegExp(this.context.wrapCommentRight()),f=Codewave.util.escapeRegExp(this.deco),g=b.multiline?"gm":"",i=new RegExp("^\\s*"+d+"(?:"+f+")*\\s{0,"+this.pad+"}",g),j=new RegExp("\\s*(?:"+f+")*"+e+"\\s*$",g),a.replace(i,"").replace(j,"")):void 0},a}(),this.Codewave.ClosingPromp=function(){function a(a,b){this.codewave=a,this.timeout=null,this._typed=null,this.started=!1,this.selections=Codewave.util.posCollection(b)}return a.prototype.begin=function(){return this.started=!0,this.addCarrets(),this.codewave.editor.canListenToChange()&&(this.proxyOnChange=function(a){return function(b){return null==b&&(b=null),a.onChange(b)}}(this),setTimeout(function(a){return function(){return a.codewave.editor.addChangeListener(a.proxyOnChange)}}(this),2e3)),this},a.prototype.addCarrets=function(){return this.replacements=this.selections.wrap(this.codewave.brakets+this.codewave.carretChar+this.codewave.brakets+"\n","\n"+this.codewave.brakets+this.codewave.closeChar+this.codewave.carretChar+this.codewave.brakets).map(function(a){return a.carretToSel()}),this.codewave.editor.applyReplacements(this.replacements)},a.prototype.onChange=function(a){return null==a&&(a=null),this._typed=null,this.skipEvent(a)?void 0:this.shouldStop()?(this.stop(),this.cleanClose()):this["continue"]()},a.prototype.skipEvent=function(a){return null!=a&&32!==a.charCodeAt(0)},a.prototype["continue"]=function(){},a.prototype.shouldStop=function(){return this.typed()===!1||-1!==this.typed().indexOf(" ")},a.prototype.cleanClose=function(){var a,b,c,d,e,f,g,h,i,j;for(f=[],i=this.getSelections(),d=0,b=i.length;b>d;d++)h=i[d],(c=this.whithinOpenBounds(h))?j=h:(a=this.whithinCloseBounds(h))&&null!=j&&(g=a.innerTextFromEditor(this.codewave.editor).split(" ")[0],e=new Codewave.util.Replacement(a.innerStart,a.innerEnd,g),console.log(e,a,i),e.selections=[j],f.push(e),j=null);return this.codewave.editor.applyReplacements(f)},a.prototype.getSelections=function(){return this.codewave.editor.getMultiSel()},a.prototype.stop=function(){throw console.log(this),"Nope"},a.prototype.cancel=function(){return this.typed()!==!1&&this.cancelSelections(this.getSelections()),this.stop()},a.prototype.cancelSelections=function(a){var b,c,d,e,f,g,h;for(f=[],h=null,e=0,c=a.length;c>e;e++)g=a[e],(d=this.whithinOpenBounds(g))?h=d:(b=this.whithinCloseBounds(g))&&null!=h&&(h=null,f.push(new Codewave.util.Replacement(h.start,b.end,this.codewave.editor.textSubstr(h.end+1,b.start-1)).selectContent()));return this.codewave.editor.applyReplacements(this.replacements)},a.prototype.typed=function(){var a,b,c;return null==this._typed&&(a=this.codewave.editor.getCursorPos(),c=this.replacements[0].start+this.codewave.brakets.length,this.codewave.findPrevBraket(a.start)===this.replacements[0].start&&null!=(b=this.codewave.findNextBraket(c))&&b>=a.end?(console.log("found",[a,c,b]),this._typed=this.codewave.editor.textSubstr(c,b)):(console.log("not found",[a,c,b]),this._typed=!1)),this._typed},a.prototype.whithinOpenBounds=function(a){var b,c,d,e,f,g,h;for(e=this.replacements,b=d=0,c=e.length;c>d;b=++d)if(f=e[b],g=this.startPosAt(b),h=this.codewave.brakets+this.typed()+this.codewave.brakets,g.innerContainsPos(a)&&g.textFromEditor(this.codewave.editor)===h)return g;return!1},a.prototype.whithinCloseBounds=function(a){var b,c,d,e,f,g,h;for(e=this.replacements,b=d=0,c=e.length;c>d;b=++d)if(f=e[b],g=this.endPosAt(b),h=this.codewave.brakets+this.codewave.closeChar+this.typed()+this.codewave.brakets,g.innerContainsPos(a)&&g.textFromEditor(this.codewave.editor)===h)return g;return!1},a.prototype.startPosAt=function(a){return new Codewave.util.Pos(this.replacements[a].selections[0].start+2*this.typed().length*a,this.replacements[a].selections[0].end+this.typed().length*(2*a+1)).wrappedBy(this.codewave.brakets,this.codewave.brakets)},a.prototype.endPosAt=function(a){return new Codewave.util.Pos(this.replacements[a].selections[1].start+this.typed().length*(2*a+1),this.replacements[a].selections[1].end+this.typed().length*(2*a+2)).wrappedBy(this.codewave.brakets+this.codewave.closeChar,this.codewave.brakets)},a}(),this.Codewave.SimulatedClosingPromp=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype["continue"]=function(){return this.simulateType()},b.prototype.simulateType=function(){return null!=this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(a){return function(){var b,c,d;return d=a.codewave.brakets+a.codewave.closeChar+a.typed()+a.codewave.brakets,b=a.whithinCloseBounds(a.replacements[0].selections[1].copy().applyOffset(a.typed().length)),b?(c=new Codewave.util.Replacement(b.start,b.end,d),c.necessaryFor(a.codewave.editor)?(console.log("replacement start"),a.codewave.editor.applyReplacements([c]),console.log("replacement end")):void 0):a.stop()}}(this),2)},b.prototype.skipEvent=function(){return!1},b.prototype.getSelections=function(){return[this.codewave.editor.getCursorPos(),this.replacements[0].selections[1]+this.typed().length]},b.prototype.whithinCloseBounds=function(a){var b,c,d,e,f,g,h;for(f=this.replacements,b=e=0,c=f.length;c>e;b=++e)if(g=f[b],h=this.endPosAt(b),d=this.codewave.findNextBraket(h.innerStart),null!=d&&(h.moveSuffix(d),h.innerContainsPos(a)))return h;return!1},b}(Codewave.ClosingPromp),this.Codewave.ClosingPromp.newFor=function(a,b){return a.editor.allowMultiSelection()?new Codewave.ClosingPromp(a,b):new Codewave.SimulatedClosingPromp(a,b)},this.Codewave.CmdFinder=function(){function a(a,b){var c,d,e;"string"==typeof a&&(a=[a]),c={parent:null,namespaces:[],parentContext:null,context:null,root:Codewave.Command.cmds,mustExecute:!0,useDetectors:!0,useFallbacks:!0,instance:null,codewave:null},this.names=a,this.parent=b.parent;for(d in c)e=c[d],d in b?this[d]=b[d]:null!=this.parent&&"parent"!==d?this[d]=this.parent[d]:this[d]=e;null==this.context&&(this.context=new Codewave.Context(this.codewave)),null!=this.parentContext&&(this.context.parent=this.parentContext),null!=this.namespaces&&this.context.addNamespaces(this.namespaces)}return a.prototype.find=function(){return this.triggerDetectors(),this.cmd=this.findIn(this.root),this.cmd},a.prototype.getPosibilities=function(){var a;return this.triggerDetectors(),a=list(this.path),this.findPosibilitiesIn(this.root,a)},a.prototype.getNamesWithPaths=function(){var a,b,c,d,e,f,g,h;for(c={},e=this.names,d=0,a=e.length;a>d;d++)b=e[d],f=Codewave.util.splitFirstNamespace(b),h=f[0],g=f[1],null==h||A.call(this.context.getNameSpaces(),h)>=0||(h in c||(c[h]=[]),c[h].push(g));return c},a.prototype.applySpaceOnNames=function(a){var b,c,d;return b=Codewave.util.splitFirstNamespace(a,!0),d=b[0],c=b[1],this.names.map(function(a){var b,e,f;return f=Codewave.util.splitFirstNamespace(a),e=f[0],b=f[1],null!=e&&e===d&&(a=b),null!=c&&(a=c+":"+a),a})},a.prototype.getDirectNames=function(){var a;return function(){var b,c,d,e;for(d=this.names,e=[],c=0,b=d.length;b>c;c++)a=d[c],-1===a.indexOf(":")&&e.push(a);

return e}.call(this)},a.prototype.triggerDetectors=function(){var a,b,c,d,e,f,g,h,i;if(this.useDetectors){for(this.useDetectors=!1,e=new Codewave.CmdFinder(this.context.getNameSpaces(),{parent:this,mustExecute:!1,useFallbacks:!1}).findPosibilities(),c=0,i=[];c<e.length;){for(a=e[c],g=a.detectors,f=0,d=g.length;d>f;f++)b=g[f],h=b.detect(this),null!=h&&(this.context.addNamespaces(h),e=e.concat(new Codewave.CmdFinder(h,{parent:this,mustExecute:!1,useFallbacks:!1}).findPosibilities()));i.push(c++)}return i}},a.prototype.findIn=function(a,b){var c;return null==b&&(b=null),null==a?null:(c=this.bestInPosibilities(this.findPosibilities()),null!=c?c:void 0)},a.prototype.findPosibilities=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(null==this.root)return[];this.root.init(),j=[],l=this.getNamesWithPaths();for(q in l)f=l[q],g=this.getCmdFollowAlias(q),null!=g&&(j=j.concat(new Codewave.CmdFinder(f,{parent:this,root:g}).findPosibilities()));for(m=this.context.getNameSpaces(),k=0,c=m.length;c>k;k++)h=m[k],n=Codewave.util.splitFirstNamespace(h,!0),i=n[0],p=n[1],g=this.getCmdFollowAlias(i),null!=g&&(j=j.concat(new Codewave.CmdFinder(this.applySpaceOnNames(h),{parent:this,root:g}).findPosibilities()));for(o=this.getDirectNames(),r=0,d=o.length;d>r;r++)e=o[r],a=this.root.getCmd(e),this.cmdIsValid(a)&&j.push(a);return this.useFallbacks&&(b=this.root.getCmd("fallback"),this.cmdIsValid(b)&&j.push(b)),j},a.prototype.getCmdFollowAlias=function(a){var b;return b=this.root.getCmd(a),null!=b&&(b.init(),null!=b.aliasOf)?b.getAliased():b},a.prototype.cmdIsValid=function(a){return null==a?!1:(a.init(),!this.mustExecute||a.isExecutable())},a.prototype.cmdScore=function(a){var b;return b=a.depth,"fallback"===a.name&&(b-=1e3),b},a.prototype.bestInPosibilities=function(a){var b,c,d,e,f,g;if(a.length>0){for(b=null,c=null,f=0,d=a.length;d>f;f++)e=a[f],g=this.cmdScore(e),(null==b||g>=c)&&(c=g,b=e);return b}},a}(),this.Codewave.CmdInstance=function(){function a(a,b){this.cmd=a,this.context=null!=b?b:None}return a.prototype.init=function(){return this.isEmpty()||this.inited||(this.inited=!0,this._getCmdObj(),this._initParams(),null!=this.cmdObj&&this.cmdObj.init()),this},a.prototype.setParam=function(a,b){return this.named[a]=b},a.prototype.pushParam=function(a){return this.params.push(a)},a.prototype.getContext=function(){return null==this.context&&(this.context=new Codewave.Context),this.context||new Codewave.Context},a.prototype.getFinder=function(a){var b;return b=this.getContext().getFinder(a,this._getParentNamespaces()),b.instance=this,b},a.prototype._getCmdObj=function(){var a;return null!=this.cmd&&(this.cmd.init(),a=this.getAliased()||this.cmd,a.init(),null!=a.cls)?(this.cmdObj=new a.cls(this),this.cmdObj):void 0},a.prototype._initParams=function(){return this.named=this.getDefaults(this)},a.prototype._getParentNamespaces=function(){return array()},a.prototype.isEmpty=function(){return null!=this.cmd},a.prototype.resultIsAvailable=function(){var a;return null!=this.cmd?null!=this.cmdObj?this.cmdObj.resultIsAvailable():(a=this.getAliased(),null!=a?a.resultIsAvailable():this.cmd.resultIsAvailable()):!1},a.prototype.getDefaults=function(){var a,b;return null!=this.cmd?(b={},a=this.getAliased(),null!=a&&(b=Codewave.util.merge(b,a.getDefaults())),b=Codewave.util.merge(b,cmd.defaults),null!=this.cmdObj&&(b=Codewave.util.merge(b,this.cmdObj.getDefaults())),b):void 0},a.prototype.getAliased=function(){var a,b;if(null!=this.cmd){if(null!=this.aliasedCmd)return this.aliasedCmd||null;if(null!=this.cmd.aliasOf)return a=this.cmd.aliasOf.replace("%name%",this.cmdName),b=this.cmd._aliasedFromFinder(this.getFinder(a)),this.aliasedCmd=b||!1,b}},a.prototype.getOptions=function(){var a;return null!=this.cmd?null!=this.cmdOptions?this.cmdOptions:(a=this.cmd._optionsForAliased(this.getAliased()),null!=this.cmdObj&&(a=Codewave.util.merge(a,this.cmdObj.getOptions())),this.cmdOptions=a,a):void 0},a.prototype.getOption=function(a){var b;return b=this.getOptions(),null!=b&&a in b?b[a]:void 0},a.prototype.getParam=function(a,b){var c,d,e,f;for(null==b&&(b=null),("string"==(f=typeof a)||"number"===f)&&(a=[a]),e=0,c=a.length;c>e;e++){if(d=a[e],null!=this.named[d])return this.named[d];if(null!=this.params[d])return this.params[d]}return b},a.prototype.runExecuteFunct=function(){var a;if(null!=this.cmd){if(null!=this.cmdObj)return this.cmdObj.execute();if(a=this.getAliased()||this.cmd,a.init(),null!=a.executeFunct)return a.executeFunct(this)}},a.prototype.rawResult=function(){var a;if(null!=this.cmd){if(null!=this.cmdObj)return this.cmdObj.result();if(a=this.getAliased()||this.cmd,a.init(),null!=a.resultFunct)return a.resultFunct(this);if(null!=a.resultStr)return a.resultStr}},a.prototype.result=function(){var a,b,c;return this.init(),this.resultIsAvailable()&&null!=(c=this.rawResult())?(c=this.formatIndent(c),c.length>0&&this.getOption("parse",this)&&(b=this.getParserForText(c),c=b.parseAll()),(a=this.getOption("alterResult",this))&&(c=a(c,this)),c):void 0},a.prototype.getParserForText=function(a){var b;return null==a&&(a=""),b=new Codewave(new Codewave.TextParser(a),{inInstance:this}),b.checkCarret=!1,b},a.prototype.getIndent=function(){return 0},a.prototype.formatIndent=function(a){return null!=a?a.replace(/\t/g,"  "):a},a.prototype.applyIndent=function(a){var b;return null!=a?(b=/\n/g,a.replace(b,"\n"+Codewave.util.repeatToLength(" ",this.getIndent()))):a},a}(),m=function(a,b,c){return null==c&&(c=null),a in b?b[a]:c},this.Codewave.Command=function(){function a(a,b,c){var d;this.name=a,this.data=null!=b?b:null,this.parent=null!=c?c:null,this.cmds=[],this.detectors=[],this.executeFunct=this.resultFunct=this.resultStr=this.aliasOf=this.cls=null,this.aliased=null,this.fullName=this.name,this.depth=0,d=[null,!1],this._parent=d[0],this._inited=d[1],this.setParent(parent),this.defaults={},this.defaultOptions={nameToParam:null,checkCarret:!0,parse:!1,beforeExecute:null,alterResult:null,preventParseAll:!1,replaceBox:!1},this.options={},this.finalOptions=null}return a.prototype.parent=function(){return this._parent},a.prototype.setParent=function(a){return this._parent!==a?(this._parent=a,this.fullName=null!=this._parent&&null!=this._parent.name?this._parent.fullName+":"+this.name:this.name,this.depth=null!=this._parent&&null!=this._parent.depth?this._parent.depth+1:0):void 0},a.prototype.init=function(){return this._inited||(this._inited=!0,this.parseData(this.data)),this},a.prototype.unregister=function(){return this._parent.removeCmd(this)},a.prototype.isEditable=function(){return null!=this.resultStr||null!=this.aliasOf},a.prototype.isExecutable=function(){var a,b,c,d,e;if(a=this.getAliased(),null!=a)return a.isExecutable();for(e=["resultStr","resultFunct","cls","executeFunct"],d=0,b=e.length;b>d;d++)if(c=e[d],null!=this[c])return!0;return!1},a.prototype.resultIsAvailable=function(){var a,b,c,d,e;if(a=this.getAliased(),null!=a)return a.resultIsAvailable();for(e=["resultStr","resultFunct"],d=0,b=e.length;b>d;d++)if(c=e[d],null!=this[c])return!0;return!1},a.prototype.getDefaults=function(){var a,b;return b={},a=this.getAliased(),null!=a&&(b=Codewave.util.merge(b,a.getDefaults())),b=Codewave.util.merge(b,this.defaults)},a.prototype._aliasedFromFinder=function(a){return a.useFallbacks=!1,a.mustExecute=!1,a.find()},a.prototype.getAliased=function(){var a;return null!=this.aliasOf?(a=new Codewave.Context,this._aliasedFromFinder(a.getFinder(this.aliasOf))):void 0},a.prototype.setOptions=function(a){var b,c,d;c=[];for(b in a)d=a[b],c.push(b in this.defaultOptions?this.options[b]=d:void 0);return c},a.prototype._optionsForAliased=function(a){var b;return b={},b=Codewave.util.merge(b,this.defaultOptions),null!=a&&(b=Codewave.util.merge(b,a.getOptions())),Codewave.util.merge(b,this.options)},a.prototype.getOptions=function(){return this._optionsForAliased(this.getAliased())},a.prototype.getOption=function(a){var b;return b=this.getOptions(),a in b?b[a]:void 0},a.prototype.help=function(){var a;return a=this.getCmd("help"),null!=a?a.init().resultStr:void 0},a.prototype.parseData=function(a){return this.data=a,"string"==typeof a?(this.resultStr=a,this.options.parse=!0,!0):null!=a?this.parseDictData(a):!1},a.prototype.parseDictData=function(b){var c,d;return d=m("result",b),"function"==typeof d?this.resultFunct=d:null!=d&&(this.resultStr=d,this.options.parse=!0),c=m("execute",b),"function"==typeof c&&(this.executeFunct=c),this.aliasOf=m("aliasOf",b),this.cls=m("cls",b),this.defaults=m("defaults",b,this.defaults),this.setOptions(b),"help"in b&&this.addCmd(new a("help",b.help,this)),"fallback"in b&&this.addCmd(new a("fallback",b.fallback,this)),"cmds"in b&&this.addCmds(b.cmds),!0},a.prototype.addCmds=function(b){var c,d,e;e=[];for(d in b)c=b[d],e.push(this.addCmd(new a(d,c,this)));return e},a.prototype.addCmd=function(a){var b;return b=this.getCmd(a.name),null!=b&&this.removeCmd(b),a.setParent(this),this.cmds.push(a),a},a.prototype.removeCmd=function(a){var b;return(b=this.cmds.indexOf(a))>-1&&this.cmds.splice(b,1),a},a.prototype.getCmd=function(a){var b,c,d,e,f,g,h;if(this.init(),f=Codewave.util.splitFirstNamespace(a),h=f[0],d=f[1],null!=h)return this.getCmd(h).getCmd(d);for(g=this.cmds,e=0,c=g.length;c>e;e++)if(b=g[e],b.name===d)return b},a.prototype.setCmdData=function(a,b){return this.setCmd(a,new Codewave.Command(a.split(":").pop(),b))},a.prototype.setCmd=function(b,c){var d,e,f,g;return f=Codewave.util.splitFirstNamespace(b),g=f[0],d=f[1],null!=g?(e=this.getCmd(g),null==e&&(e=this.addCmd(new a(g))),e.setCmd(d,c)):(this.addCmd(c),c)},a.prototype.addDetector=function(a){return this.detectors.push(a)},a}(),this.Codewave.Command.cmdInitialisers=[],this.Codewave.Command.initCmds=function(){var a,b,c,d,e;for(Codewave.Command.cmds=new Codewave.Command(null,{cmds:{hello:{help:'"Hello, world!" is typically one of the simplest programs possible in\nmost programming languages, it is by tradition often (...) used to\nverify that a language or system is operating correctly -wikipedia',result:"Hello, World!"}}}),d=Codewave.Command.cmdInitialisers,e=[],c=0,b=d.length;b>c;c++)a=d[c],e.push(a());return e},this.Codewave.Command.saveCmd=function(a,b){var c;return Codewave.Command.cmds.setCmdData(a,b),c=Codewave.storage.load("cmds"),null==c&&(c={}),c[a]=b,Codewave.storage.save("cmds",c)},this.Codewave.Command.loadCmds=function(){var a,b,c,d;if(d=Codewave.storage.load("cmds"),null!=d){c=[];for(b in d)a=d[b],c.push(Codewave.Command.cmds.setCmdData(b,a));return c}},this.Codewave.Command.resetSaved=function(){return Codewave.storage.save("cmds",{})},this.Codewave.BaseCommand=function(){function a(a){this.instance=a}return a.prototype.init=function(){},a.prototype.resultIsAvailable=function(){return null!=this.result},a.prototype.getDefaults=function(){return{}},a.prototype.getOptions=function(){return{}},a}(),this.Codewave.Context=function(){function a(a){this.codewave=a,this.nameSpaces=[]}return a.prototype.addNameSpace=function(a){return A.call(this.nameSpaces,a)<0?(this.nameSpaces.push(a),this._namespaces=null):void 0},a.prototype.addNamespaces=function(a){var b,c,d,e;if(a){for("string"==typeof a&&(a=[a]),d=[],c=0,b=a.length;b>c;c++)e=a[c],d.push(this.addNameSpace(e));return d}},a.prototype.removeNameSpace=function(a){return this.nameSpaces=this.nameSpaces.filter(function(b){return b!==a})},a.prototype.getNameSpaces=function(){var a;return null==this._namespaces&&(a=["core"].concat(this.nameSpaces),null!=this.parent&&(a=a.concat(this.parent.getNameSpaces())),this._namespaces=Codewave.util.unique(a)),this._namespaces},a.prototype.getCmd=function(a,b){var c;return null==b&&(b=[]),c=this.getFinder(a,b),c.find()},a.prototype.getFinder=function(a,b){return null==b&&(b=[]),new Codewave.CmdFinder(a,{namespaces:b,useDetectors:this.isRoot(),codewave:this.codewave,parentContext:this})},a.prototype.isRoot=function(){return null==this.parent},a.prototype.wrapComment=function(a){var b;return b=this.getCommentChar(),b.indexOf("%s")>-1?b.replace("%s",a):b+" "+a+" "+b},a.prototype.wrapCommentLeft=function(a){var b,c;return null==a&&(a=""),b=this.getCommentChar(),(c=b.indexOf("%s"))>-1?b.substr(0,c)+a:b+" "+a},a.prototype.wrapCommentRight=function(a){var b,c;return null==a&&(a=""),b=this.getCommentChar(),(c=b.indexOf("%s"))>-1?a+b.substr(c+2):a+" "+b},a.prototype.cmdInstanceFor=function(a){return new Codewave.CmdInstance(a,this)},a.prototype.getCommentChar=function(){var a,b,c,d;return null!=this.commentChar?this.commentChar:(b=this.getCmd("comment"),a="<!-- %s -->",null!=b&&(c=this.cmdInstanceFor(b),c.content="%s",d=c.result(),null!=d&&(a=d)),this.commentChar=a,this.commentChar)},a}(),r=function(){var f,g,h,i,j,k,l;return f=Codewave.Command.cmds.addCmd(new Codewave.Command("core")),f.addDetector(new Codewave.LangDetector),f.addCmds({help:{replaceBox:!0,result:'~~box~~\n~~quote_carret~~\n  ___         _   __      __\n / __|___  __| |__\\ \\    / /_ ___ ______\n/ /__/ _ \\/ _` / -_\\ \\/\\/ / _` \\ V / -_/\n\\____\\___/\\__,_\\___|\\_/\\_/\\__,_|\\_/\\___|\nThe text editor helper\n~~/quote_carret~~\n\nWhen using Codewave you will be writing commands directly within \nyour text editor editing windows. These commands must be placed\nbetween two pairs of "~" (tilde) and then with you text either \ninside or at the command, they can be executed by pressing \n"ctrl"+"shift"+"e".\nEx: ~~!hello~~\n\nOne good thing about codewave is that you dont need to actually\ntype any "~" (tilde), because pressing "ctrl"+"shift"+"e" will\nadd them if you are not allready within a command\n\nCodewave does not relly use UI to display any information. \ninstead, it uses text within code comments to mimic UIs. The \ngenerated comment blocks will be refered as windows in the help\nsections.\n\nTo close this window (ie. remove this comment bloc), press \n"ctrl"+"shift"+"e" with you cursor on the line bellow.\n~~!close|~~\n\nUse the following command for a walkthrough of some of many\nfeatures of codewave\n~~!help:get_started~~ or ~~!help:demo~~\n\nList of all helps subjects \n~~!help:subjects~~ or ~~!help:sub~~ \n\n~~!close~~\n~~/box~~',cmds:{subjects:{replaceBox:!0,result:"~~box~~\n~~!help~~\n~~!help:get_started~~ (~~!help:demo~~)\n~~!help:subjects~~ (~~!help:sub~~)\n~~!help:editing~~ (~~!help:edit~~)\n~~!close|~~\n~~/box~~"},sub:{aliasOf:"help:subjects"},get_started:{replaceBox:!0,result:'~~box~~\nThe classic Hello World.\n~~!hello|~~\n\n~~help:editing:intro~~\n~~quote_carret~~\n\nfor more information on creating your own commands, see:\n~~!help:editing~~\n\nCodewave come with many prexisting commands. Here an example of \njavascript abreviations\n~~!js:f~~\n~~!js:if~~\n  ~~!js:log~~"~~!hello~~"~~!/js:log~~\n~~!/js:if~~\n~~!/js:f~~\n\nCodeWave come with the exellent Emmet ( http://emmet.io/ ) to \nprovide event more abreviations. Emmet will fire automaticaly if\nyou are in a html or css file and no other command of the same \nname were defined.\n~~!ul>li~~ (if you are in a html doccument)\n~~!emmet ul>li~~\n~~!emmet m2 css~~\n\nCommands are stored in name spaces and some of the namespaces are\nactive depending of the context or they can be called explicitly. \nThe two following commands are the same and will display the \ncurrently  active namespace. The first command command works \nbecause the core namespace is active.\n~~!namespace~~\n~~!core:namespace~~\n\nyou can make an namespace active with the following command.\n~~!namespace php~~\n\nCheck the namespaces again\n~~!namespace~~\n\nAll the dialogs(windows) of codewave are made with the command \n"box" and you can use it in your own commands. you can also use a\n"close" command to make it easy to get rid of the window.\n~~!box~~\nThe box will scale with the content you put in it\n~~!close|~~\n~~!/box~~\n\n~~/quote_carret~~\n~~!close|~~\n~~/box~~'},demo:{aliasOf:"help:get_started"},editing:{cmds:{intro:{result:'Codewave allows you to make you own commands (or abbreviations) \nput your content inside "source" the do "save". Try adding any \ntext that is on your mind.\n~~!edit my_new_command|~~\n\nIf you did the last step right, you should see your text when you\ndo the following command. It is now saved and you can use it \nwhenever you want.\n~~!my_new_command~~'}},replaceBox:!0,result:'~~box~~\n~~help:editing:intro~~\n\n~~quote_carret~~\nWhen you make your command you may need to tell where the text cursor \nwill be located once the command is executed. To do that, use a "|" \n(Vertical bar). Use 2 of them if you want to print the actual \ncharacter.\n~~!box~~\none : | \ntwo : ||\n~~!/box~~\n\nIf you want to print a command without having it evalute when \nthe command is executed, use a "!" exclamation mark.\n~~!!hello~~\n\nfor commands that have both a openig and a closing tag, you can use\nthe "content" command. "content" will be replaced with the text\nthat is between tha tags. Look at the code of the following command\nfor en example of how it can be used.\n~~!edit php:inner:if~~\n\n~~/quote_carret~~\n~~!close|~~\n~~/box~~'},edit:{aliasOf:"help:editing"}}},no_execute:{result:s},quote_carret:{result:t,checkCarret:!1},exec_parent:{execute:p},content:{result:q},box:{cls:a},close:{cls:b},edit:{cmds:c.setCmds({save:{aliasOf:"core:exec_parent"}}),cls:c},rename:{cmds:{not_applicable:"~~box~~\nYou cant rename a command you did not create yourself.\n~~!close|~~\n~~/box~~",not_found:"~~box~~\nCommand not found\n~~!close|~~\n~~/box~~"},result:v,parse:!0},remove:{cmds:{not_applicable:"~~box~~\nYou cant remove a command you did not create yourself.\n~~!close|~~\n~~/box~~",not_found:"~~box~~\nCommand not found\n~~!close|~~\n~~/box~~"},result:u,parse:!0},alias:{cmds:{not_found:"~~box~~\nCommand not found\n~~!close|~~\n~~/box~~"},result:n,parse:!0},namespace:{cls:e},nspc:{aliasOf:"core:namespace"},emmet:{cls:d}}),h=Codewave.Command.cmds.addCmd(new Codewave.Command("html")),h.addCmds({fallback:{aliasOf:"core:emmet",defaults:{lang:"html"},nameToParam:"abbr"}}),g=Codewave.Command.cmds.addCmd(new Codewave.Command("css")),g.addCmds({fallback:{aliasOf:"core:emmet",defaults:{lang:"css"},nameToParam:"abbr"}}),j=Codewave.Command.cmds.addCmd(new Codewave.Command("php")),j.addDetector(new Codewave.PairDetector({result:"php:inner",opener:"<?php",closer:"?>","else":"php:outer"})),l=j.addCmd(new Codewave.Command("outer")),l.addCmds({fallback:{aliasOf:"php:inner:%name%",beforeExecute:o,alterResult:w},comment:"<?php /* ~~content~~ */ ?>",php:"<?php\n	~~content~~|\n?>"}),k=j.addCmd(new Codewave.Command("inner")),k.addCmds({comment:"/* ~~content~~ */","if":"if(|){\n	~~content~~\n}",info:"phpinfo();",echo:"echo ${id}",e:{aliasOf:"php:inner:echo"},"class":"class | {\n	function __construct() {\n		~~content~~\n	}\n}",c:{aliasOf:"php:inner:class"},"function":"function |() {\n	~~content~~\n}",funct:{aliasOf:"php:inner:function"},f:{aliasOf:"php:inner:function"},array:"$| = array();",a:"array()","for":"for ($i = 0; $i < $|; $i++) {\n	~~content~~\n}",foreach:"foreach ($| as $key => $val) {\n	~~content~~\n}",each:{aliasOf:"php:inner:foreach"},"while":"while(|) {\n	~~content~~\n}",whilei:"$i = 0;\nwhile(|) {\n	~~content~~\n	$i++;\n}",ifelse:"if( | ) {\n	~~content~~\n} else {\n	\n}",ife:{aliasOf:"php:inner:ifelse"},"switch":"switch( | ) { \n	case :\n		~~content~~\n		break;\n	default :\n		\n		break;\n}"}),i=Codewave.Command.cmds.addCmd(new Codewave.Command("js")),Codewave.Command.cmds.addCmd(new Codewave.Command("javascript",{aliasOf:"js"})),i.addCmds({comment:"/* ~~content~~ */","if":"if(|){\n	~~content~~\n}",log:"if(window.console){\n	console.log(~~content~~|)\n}","function":"function |() {\n	~~content~~\n}",funct:{aliasOf:"js:function"},f:{aliasOf:"js:function"},"for":"for (var i = 0; i < |; i++) {\n	~~content~~\n}",forin:"foreach (var val in |) {\n	~~content~~\n}",each:{aliasOf:"js:forin"},foreach:{aliasOf:"js:forin"},"while":"while(|) {\n	~~content~~\n}",whilei:"var i = 0;\nwhile(|) {\n	~~content~~\n	i++;\n}",ifelse:"if( | ) {\n	~~content~~\n} else {\n	\n}",ife:{aliasOf:"js:ifelse"},"switch":"switch( | ) { \n	case :\n		~~content~~\n		break;\n	default :\n		\n		break;\n}"})},this.Codewave.Command.cmdInitialisers.push(r),this.Codewave.Command.setVarCmd=function(a,b){return null==b&&(b={}),b.execute=function(b){var c,d;return d=null!=(c=b.getParam(0))?c:b.content?b.content:void 0,null!=d?b.codewave.vars[a]=d:void 0},b},this.Codewave.Command.setBoolVarCmd=function(a,b){return null==b&&(b={}),b.execute=function(b){var c,d;return d=null!=(c=b.getParam(0))?c:b.content?b.content:void 0,null==d||"0"!==d&&"false"!==d&&"no"!==d?b.codewave.vars[a]=!0:void 0},b},s=function(a){var b;return b=new RegExp("^("+Codewave.util.escapeRegExp(a.codewave.brakets)+")"+Codewave.util.escapeRegExp(a.codewave.noExecuteChar)),a.str.replace(b,"$1")},t=function(a){return a.content.replace(/\|/g,"||")},p=function(a){var b;return null!=a.parent?(b=a.parent.execute(),a.replaceStart=a.parent.replaceStart,a.replaceEnd=a.parent.replaceEnd,b):void 0},q=function(a){return null!=a.codewave.inInstance?a.codewave.inInstance.content||"":void 0},w=function(a,b){var c,d;return d=/<\?php\s([\\n\\r\s]+)/g,c=/([\n\r\s]+)\s\?>/g,"<?php "+a.replace(d,"$1<?php ").replace(c," ?>$1")+" ?>"},v=function(a){var b,c,d,e,f;return f=Codewave.storage.load("cmds"),e=a.getParam([0,"from"]),d=a.getParam([1,"to"]),null!=e&&null!=d?(b=a.context.getCmd(e),console.log(b),null!=f[e]&&null!=b?(d.indexOf(":")>-1||(d=b.fullName.replace(e,"")+d),c=f[e],Codewave.Command.cmds.setCmdData(d,c),b.unregister(),f[d]=c,delete f[e],Codewave.storage.save("cmds",f),""):null!=b?"~~not_applicable~~":"~~not_found~~"):void 0},u=function(a){var b,c,d,e;return d=a.getParam([0,"name"]),null!=d?(e=Codewave.storage.load("cmds"),b=a.context.getCmd(d),null!=e[d]&&null!=b?(c=e[d],b.unregister(),delete e[d],Codewave.storage.save("cmds",e),""):null!=b?"~~not_applicable~~":"~~not_found~~"):void 0},n=function(a){var b,c,d;return d=a.getParam([0,"name"]),b=a.getParam([1,"alias"]),null!=d&&null!=b?(c=a.context.getCmd(d),null!=c?(c=c.getAliased()||c,Codewave.Command.saveCmd(b,{aliasOf:c.fullName}),""):"~~not_found~~"):void 0},o=function(a){return a.content=" ?>"+(a.content||"")+"<?php "},a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.init=function(){return this.helper=new Codewave.util.BoxHelper(this.instance.context),this.cmd=this.instance.getParam(["cmd"]),null!=this.cmd&&(this.helper.openText=this.instance.codewave.brakets+this.cmd+this.instance.codewave.brakets,this.helper.closeText=this.instance.codewave.brakets+this.instance.codewave.closeChar+this.cmd.split(" ")[0]+this.instance.codewave.brakets),this.helper.deco=this.instance.codewave.deco,this.helper.pad=2},b.prototype.height=function(){var a,b;return a=null!=this.bounds()?this.bounds().height:3,b=["height"],this.instance.params.length>1?b.push(1):this.instance.params.length>0&&b.push(0),this.instance.getParam(b,a)},b.prototype.width=function(){var a,b;return b=null!=this.bounds()?this.bounds().width:3,a=["width"],this.instance.params.length>1&&a.push(0),Math.max(this.minWidth(),this.instance.getParam(a,b))},b.prototype.bounds=function(){return this.instance.content?(null==this._bounds&&(this._bounds=this.helper.textBounds(this.instance.content)),this._bounds):void 0},b.prototype.result=function(){return this.helper.height=this.height(),this.helper.width=this.width(),this.helper.draw(this.instance.content)},b.prototype.minWidth=function(){return null!=this.cmd?this.cmd.length:0},b}(Codewave.BaseCommand),b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.init=function(){return this.helper=new Codewave.util.BoxHelper(this.instance.context)},b.prototype.execute=function(){var a;return a=this.helper.getBoxForPos(this.instance.getPos()),null!=a?(this.instance.codewave.editor.spliceText(a.start,a.end,""),this.instance.codewave.editor.setCursorPos(a.start)):this.instance.replaceWith("")},b}(Codewave.BaseCommand),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.init=function(){var a;return this.cmdName=this.instance.getParam([0,"cmd"]),this.verbalize="v"===(a=this.instance.getParam([1]))||"verbalize"===a,null!=this.cmdName&&(this.finder=this.instance.context.getFinder(this.cmdName),this.finder.useFallbacks=!1,this.cmd=this.finder.find()),this.editable=null!=this.cmd?this.cmd.isEditable():!0},b.prototype.getOptions=function(){return{allowedNamed:["cmd"]}},b.prototype.result=function(){return this.instance.content?this.resultWithContent():this.resultWithoutContent()},b.prototype.resultWithContent=function(){var a,c,d,e,f,g;for(e=this.instance.getParserForText(this.instance.content),e.parseAll(),a={},g=b.props,f=0,c=g.length;c>f;f++)d=g[f],d.writeFor(e,a);return Codewave.Command.saveCmd(this.cmdName,a),""},b.prototype.propsDisplay=function(){var a;return a=this.cmd,b.props.map(function(b){return b.display(a)}).filter(function(a){return null!=a}).join("\n")},b.prototype.resultWithoutContent=function(){var a,b;return!this.cmd||this.editable?(a=this.cmd?this.cmd.fullName:this.cmdName,b=this.instance.getParserForText('~~box cmd:"'+this.instance.cmd.fullName+" "+a+'"~~\n'+this.propsDisplay()+"\n~~save~~ ~~!close~~\n~~/box~~"),b.checkCarret=!1,this.verbalize?b.getText():b.parseAll()):void 0},b}(Codewave.BaseCommand),c.setCmds=function(a){var b,d,e,f;for(f=c.props,e=0,b=f.length;b>e;e++)d=f[e],d.setCmd(a);return a},c.props=[new Codewave.EditCmdProp.revBool("no_carret",{opt:"checkCarret"}),new Codewave.EditCmdProp.revBool("no_parse",{opt:"parse"}),new Codewave.EditCmdProp.bool("prevent_parse_all",{opt:"preventParseAll"}),new Codewave.EditCmdProp.bool("replace_box",{opt:"replaceBox"}),new Codewave.EditCmdProp.string("name_to_param",{opt:"nameToParam"}),new Codewave.EditCmdProp.string("alias_of",{"var":"aliasOf",carret:!0}),new Codewave.EditCmdProp.source("help",{funct:"help",showEmpty:!0}),new Codewave.EditCmdProp.source("source",{"var":"resultStr",dataName:"result",showEmpty:!0,carret:!0})],e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.init=function(){return this.name=this.instance.getParam([0])},b.prototype.result=function(){var a,b,c,d,e,f;if(null!=this.name)return this.instance.codewave.getRoot().context.addNameSpace(this.name),"";for(b=this.instance.context.getNameSpaces(),f="~~box~~\n",e=0,a=b.length;a>e;e++)c=b[e],c!==this.instance.cmd.fullName&&(f+=c+"\n");return f+="~~!close|~~\n~~/box~~",d=this.instance.getParserForText(f),d.parseAll()},b}(Codewave.BaseCommand),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.init=function(){return this.abbr=this.instance.getParam([0,"abbr","abbreviation"]),this.lang=this.instance.getParam([1,"lang","language"])},b.prototype.result=function(){var a;return"undefined"!=typeof emmet&&null!==emmet?(a=emmet.expandAbbreviation(this.abbr,this.lang),a.replace(/\$\{0\}/g,"|")):void 0},b}(this.Codewave.BaseCommand),this.Codewave.Detector=function(){function a(a){this.data=null!=a?a:{}}return a.prototype.detect=function(a){if(this.detected(a)){if(null!=this.data.result)return this.data.result}else if(null!=this.data["else"])return this.data["else"]},a.prototype.detected=function(a){},a}(),this.Codewave.LangDetector=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.detect=function(a){var b;return null!=a.codewave&&(b=a.codewave.editor.getLang(),null!=b)?b.toLowerCase():void 0},b}(Codewave.Detector),this.Codewave.PairDetector=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.detected=function(a){var b;return null!=this.data.opener&&null!=this.data.closer&&null!=a.instance&&(b=new Codewave.util.Pair(this.data.opener,this.data.closer,this.data),b.isWapperOf(a.instance.getPos(),a.codewave.editor.text()))?!0:!1},b}(Codewave.Detector),this.Codewave.init(),this.Codewave.detect=function(a){return new Codewave(new Codewave.TextAreaEditor(a))},this.Codewave.logger={log:function(){var a,b,c,d,e;if(a=1<=arguments.length?z.call(arguments,0):[],window.console){for(e=[],d=0,b=a.length;b>d;d++)c=a[d],e.push(console.log(c));return e}},runtime:function(a,b){var c,d,e;return null==b&&(b="function"),d=performance.now(),c=a(),e=performance.now(),console.log(b+" took "+(e-d)+" milliseconds."),c},minitorData:{},toMonitor:function(a,b,c){var d;return null==c&&(c=""),d=a[b],a[b]=function(){var e;return e=arguments,Codewave.logger.monitor(function(){return d.apply(a,e)},c+b)}},monitor:function(a,b){var c,d,e;return d=performance.now(),c=a(),e=performance.now(),null!=Codewave.logger.minitorData[b]?(Codewave.logger.minitorData[b].count++,Codewave.logger.minitorData[b].total+=e-d):Codewave.logger.minitorData[b]={count:1,total:e-d},c},resume:function(){return console.log(Codewave.logger.minitorData)}},this.Codewave.PositionedCmdInstance=function(a){function b(a,b,c){this.codewave=a,this.pos=b,this.str=c,this.isEmpty()||(this._checkCloser(),this.opening=this.str,this.noBracket=this._removeBracket(this.str),this._splitComponents(),this._findClosing(),this._checkElongated())}return x(b,a),b.prototype._checkCloser=function(){var a,b;return b=this._removeBracket(this.str),b.substring(0,this.codewave.closeChar.length)===this.codewave.closeChar&&(a=this._findOpeningPos())?(this.closingPos=new Codewave.util.StrPos(this.pos,this.str),this.pos=a.pos,this.str=a.str):void 0},b.prototype._findOpeningPos=function(){var a,b,c,d;return b=this._removeBracket(this.str).substring(this.codewave.closeChar.length),d=this.codewave.brakets+b,a=this.str,(c=this.codewave.findMatchingPair(this.pos,d,a,-1))?(c.str=this.codewave.editor.textSubstr(c.pos,this.codewave.findNextBraket(c.pos+c.str.length)+this.codewave.brakets.length),c):void 0},b.prototype._splitComponents=function(){var a;return a=this.noBracket.split(" "),this.cmdName=a.shift(),this.rawParams=a.join(" ")},b.prototype._parseParams=function(a){var b,c,d,e,f,g,h,i,j;if(this.params=[],this.named={},null!=this.cmd&&(this.named=Codewave.util.merge(this.named,this.cmd.getDefaults(this)),g=this.getOption("nameToParam"),null!=g&&(this.named[g]=this.cmdName)),a.length){for(null!=this.cmd&&(b=this.getOption("allowedNamed")),e=!1,h="",f=!1,d=i=0,j=a.length-1;j>=0?j>=i:i>=j;d=j>=0?++i:--i)c=a[d]," "!==c||e?'"'!==c&&"'"!==c||0!==d&&"\\"===a[d-1]?":"!==c||f||e||!(null==b||A.call(b,f)>=0)?h+=c:(f=h,h=""):e=!e:(f?this.named[f]=h:this.params.push(h),h="",f=!1);if(h.length)return f?this.named[f]=h:this.params.push(h)}},b.prototype._findClosing=function(){var a;return(a=this._findClosingPos())?(this.content=Codewave.util.trimEmptyLine(this.codewave.editor.textSubstr(this.pos+this.str.length,a.pos)),this.str=this.codewave.editor.textSubstr(this.pos,a.pos+a.str.length)):void 0},b.prototype._findClosingPos=function(){var a,b,c;return null!=this.closingPos?this.closingPos:(a=this.codewave.brakets+this.codewave.closeChar+this.cmdName+this.codewave.brakets,c=this.codewave.brakets+this.cmdName,(b=this.codewave.findMatchingPair(this.pos+this.str.length,c,a))?this.closingPos=b:void 0)},b.prototype._checkElongated=function(){var a,b,c;for(a=this.getEndPos(),b=this.codewave.editor.textLen();b>a&&this.codewave.editor.textSubstr(a,a+this.codewave.deco.length)===this.codewave.deco;)a+=this.codewave.deco.length;return a>=b||" "===(c=this.codewave.editor.textSubstr(a,a+this.codewave.deco.length))||"\n"===c||"\r"===c?this.str=this.codewave.editor.textSubstr(this.pos,a):void 0},b.prototype._checkBox=function(){var a,b,c;if(null==this.codewave.inInstance||"comment"!==this.codewave.inInstance.cmd.name)return a=this.context.wrapCommentLeft(),b=this.context.wrapCommentRight(),c=this.getEndPos()+b.length,this.codewave.editor.textSubstr(this.pos-a.length,this.pos)===a&&this.codewave.editor.textSubstr(c-b.length,c)===b?(this.pos=this.pos-a.length,this.str=this.codewave.editor.textSubstr(this.pos,c),this._removeCommentFromContent()):this.sameLinesPrefix().indexOf(a)>-1&&this.sameLinesSuffix().indexOf(b)>-1?(this.inBox=1,
this._removeCommentFromContent()):void 0},b.prototype._removeCommentFromContent=function(){var a,b,c,d,e,f;return this.content?(a=Codewave.util.escapeRegExp(this.context.wrapCommentLeft()),b=Codewave.util.escapeRegExp(this.context.wrapCommentRight()),c=Codewave.util.escapeRegExp(this.codewave.deco),d=new RegExp("^\\s*"+a+"(?:"+c+")+\\s*(.*?)\\s*(?:"+c+")+"+b+"$","gm"),e=new RegExp("^\\s*(?:"+c+")*"+b+"\r?\n"),f=new RegExp("\n\\s*"+a+"(?:"+c+")*\\s*$"),this.content=this.content.replace(d,"$1").replace(e,"").replace(f,"")):void 0},b.prototype._getParentCmds=function(){var a;return this.parent=null!=(a=this.codewave.getEnclosingCmd(this.getEndPos()))?a.init():void 0},b.prototype.setMultiPos=function(a){return this.multiPos=a},b.prototype.prevEOL=function(){return null==this._prevEOL&&(this._prevEOL=this.codewave.findLineStart(this.pos)),this._prevEOL},b.prototype.nextEOL=function(){return null==this._nextEOL&&(this._nextEOL=this.codewave.findLineEnd(this.getEndPos())),this._nextEOL},b.prototype.rawWithFullLines=function(){return null==this._rawWithFullLines&&(this._rawWithFullLines=this.codewave.editor.textSubstr(this.prevEOL(),this.nextEOL())),this._rawWithFullLines},b.prototype.sameLinesPrefix=function(){return null==this._sameLinesPrefix&&(this._sameLinesPrefix=this.codewave.editor.textSubstr(this.prevEOL(),this.pos)),this._sameLinesPrefix},b.prototype.sameLinesSuffix=function(){return null==this._sameLinesSuffix&&(this._sameLinesSuffix=this.codewave.editor.textSubstr(this.getEndPos(),this.nextEOL())),this._sameLinesSuffix},b.prototype._getCmdObj=function(){return this.getCmd(),this._checkBox(),this.content=this.removeIndentFromContent(this.content),b.__super__._getCmdObj.apply(this,arguments)},b.prototype._initParams=function(){return this._parseParams(this.rawParams)},b.prototype.getContext=function(){return this.context||this.codewave.context},b.prototype.getCmd=function(){return null==this.cmd&&(this._getParentCmds(),this.noBracket.substring(0,this.codewave.noExecuteChar.length)===this.codewave.noExecuteChar?(this.cmd=Codewave.Command.cmds.getCmd("core:no_execute"),this.context=this.codewave.context):(this.finder=this.getFinder(this.cmdName),this.context=this.finder.context,this.cmd=this.finder.find(),null!=this.cmd&&this.context.addNameSpace(this.cmd.fullName))),this.cmd},b.prototype.getFinder=function(a){var b;return b=this.codewave.context.getFinder(a,this._getParentNamespaces()),b.instance=this,b},b.prototype._getParentNamespaces=function(){var a,b;for(a=[],b=this;null!=b.parent;)b=b.parent,null!=b.cmd&&null!=b.cmd.fullName&&a.push(b.cmd.fullName);return a},b.prototype._removeBracket=function(a){return a.substring(this.codewave.brakets.length,a.length-this.codewave.brakets.length)},b.prototype.isEmpty=function(){return this.str===this.codewave.brakets+this.codewave.closeChar+this.codewave.brakets||this.str===this.codewave.brakets+this.codewave.brakets},b.prototype.execute=function(){var a,b;if(this.isEmpty())return null!=this.codewave.closingPromp&&null!=this.codewave.closingPromp.whithinOpenBounds(this.pos+this.codewave.brakets.length)?this.codewave.closingPromp.cancel():this.replaceWith("");if(null!=this.cmd){if((a=this.getOption("beforeExecute"))&&a(this),!this.resultIsAvailable())return this.runExecuteFunct();if(null!=(b=this.result()))return this.replaceWith(b),!0}},b.prototype.getEndPos=function(){return this.pos+this.str.length},b.prototype.getPos=function(){return new Codewave.util.Pos(this.pos,this.pos+this.str.length)},b.prototype.getIndent=function(){var a;return null==this.indentLen&&(null!=this.inBox?(a=new Codewave.util.BoxHelper(this.context),this.indentLen=a.removeComment(this.sameLinesPrefix()).length):this.indentLen=this.pos-this.codewave.findLineStart(this.pos)),this.indentLen},b.prototype.removeIndentFromContent=function(a){var b;return null!=a?(b=new RegExp("^\\s{"+this.getIndent()+"}","gm"),a.replace(b,"")):a},b.prototype.alterResultForBox=function(a){var b,c,d,e,f;return c=new Codewave.util.BoxHelper(this.context),c.getOptFromLine(this.rawWithFullLines(),!1),this.getOption("replaceBox")?(b=c.getBoxForPos(this.getPos()),d=[b.start,b.end],a.start=d[0],a.end=d[1],this.indentLen=c.indent,a.text=this.applyIndent(a.text)):(a.text=this.applyIndent(a.text),a.start=this.prevEOL(),a.end=this.nextEOL(),f=c.reformatLines(this.sameLinesPrefix()+this.codewave.marker+a.text+this.codewave.marker+this.sameLinesSuffix(),{multiline:!1}),e=f.split(this.codewave.marker),a.prefix=e[0],a.text=e[1],a.suffix=e[2]),a},b.prototype.getCursorFromResult=function(a){var b,c;return b=a.resPosBeforePrefix(),null!=this.cmd&&this.codewave.checkCarret&&this.getOption("checkCarret")&&(null!=(c=this.codewave.getCarretPos(a.text))&&(b=a.start+a.prefix.length+c),a.text=this.codewave.removeCarret(a.text)),b},b.prototype.checkMulti=function(a){var b,c,d,e,f,g,h,i,j;if(null!=this.multiPos&&this.multiPos.length>1){for(j=[a],f=a.originalTextWith(this.codewave.editor),i=this.multiPos,b=h=0,c=i.length;c>h;b=++h)g=i[b],0===b?e=g.start:(d=a.copy().applyOffset(g.start-e),d.originalTextWith(this.codewave.editor)===f&&j.push(d));return j}return[a]},b.prototype.replaceWith=function(a){var b,c,d;return c=new Codewave.util.Replacement(this.pos,this.getEndPos(),a),null!=this.inBox?this.alterResultForBox(c):c.text=this.applyIndent(c.text),b=this.getCursorFromResult(c),c.selections=[new Codewave.util.Pos(b,b)],d=this.checkMulti(c),this.codewave.editor.applyReplacements(d),console.log([a,c,this,this.codewave.editor.text()]),this.replaceStart=c.start,this.replaceEnd=c.resEnd()},b}(this.Codewave.CmdInstance),this.Codewave.Process=function(){function a(){}return a}(),this.Codewave.TestEditor=function(a){function b(a){b.__super__.constructor.call(this,a),this.selections=[]}return x(b,a),b.prototype.allowMultiSelection=function(){return!0},b.prototype.setCursorPos=function(a,c){var d;return arguments.length<2&&(c=a),d=this.getCursorPos(),a!==d.start||c!==d.end?(b.__super__.setCursorPos.call(this,a,c),this.selections=[new Codewave.util.Pos(a,c)]):void 0},b.prototype.setMultiSel=function(a){return a.length>0&&this.setCursorPos(a[0].start,a[0].end),this.selections=a},b.prototype.getMultiSel=function(){var a;return a=this.selections,a[0]=this.getCursorPos(),a},b.prototype.addSel=function(a,b){return this.selections.push(new Codewave.util.Pos(a,b))},b.prototype.resetSel=function(a,b){return this.selections=[this.getCursorPos()]},b}(Codewave.TextAreaEditor)}).call(this);